# <img src="https://julianodb.github.io/SISTEMAS_ELECTRONICOS_PARA_INGENIERIA_BIOMEDICA/img/logo_fing.png?raw=true" align="right" height="45"> Trabajo 5 de Sistemas Electrónicos

#### Segundo Semestre de 2025

## Introducción

Este semestre, su grupo es responsable de diseñar y fabricar un prototipo de estetoscopio electrónico para aplicar los conocimientos y tecnicas relacionados a la asignatura de Sistemas Electrónicos.

El prototipo debe tener las siguientes funcionalidades:

1. Medir, amplificar, filtrar y reproducir los sonidos corporales
1. Permitir controlar el volúmen
1. Estimar y permitir la visualización de la frecuencia cardíaca (Heart Rate - HR)
1. Emitir una señal de luz cuando hay un pulso cardíaco

El sistema que deben diseñar puede ser dividido en los siguientes bloques:

![TX](../img/TX.png)

Figura 1: División del sistema del estetoscopio electrónico en bloques

En el quinto trabajo, los objetivos son los siguientes:

1. Diseñar los circuitos de las luces de encendido y de la luz indicadora de pulso
1. Diseñar el detector de envolvente
1. Estudiar el display

El trabajo será un ensayo que debe contener la siguiente información:

- Identificación del grupo (color)
- Identificación de los integrantes del grupo (nombres, apellidos y RUT)
- La información que se pide en cada una de las siguientes sesiones de este documento

## 1. Luces de encendido e indicación de pulso

Se disponen de LEDs de 3 mm de diametro de 5 colores distintos (Rojo/Amarillo/Verde/Azul/Blanco) para cumplir la función de indicación luminosa. Estos se utilizarán tanto para mostrar que las placas están correctamente energizadas (luces de encendido), como para indicar la detección de cada pulso cardíaco. Cada grupo utilizará 3 LEDs del mismo color para su prototipo (con el color que equivale al nombre de su grupo). 

No se disponen de los números de parte ni de las características eléctricas de los LEDs, por lo que parte de su tarea es encontrar dicha información online.

Indiquen en el ensayo:

1. Identificación de 2 posibles hojas de datos (datasheets) para LEDs del color del grupo. Indicar link de origen donde se pueden descargar. (0.3pt)
1. Elección de una de las hojas de datos e identificación de los siguientes parametros (0.6pt):
    1. Voltaje de polarización directa máxima $V_{f,max}$
    1. Voltaje de polarización reversa máxima $V_{r,max}$
    1. Corriente directa máxima $I_{f,max}$*
    1. Potencia disipada máxima $P_{D,max}$
    1. Corriente de prueba $I_f$
    1. Voltaje de polarización directa para la corriente de prueba $V_f$

Para encender cada LED se utilizará el siguiente circuito:

<img src="https://julianodb.github.io/electronic_circuits_diagrams/resistance_led_5.png" width="70">

Figura 2: Circuito de la indicación luminosa

El objetivo es obtener una corriente en el LED que sea cercana al valor de su corriente de prueba $I_f$. Se disponen de un conjunto de resistencias de 1/4 W, cuyos valores están indicados en la tabla anexa. Indiquen en el ensayo:

3. Cálculo del valor de la resistencia $R_{22}$ para que el LED se encienda con una corriente equivalente a la corriente de prueba $I_f$ de su datasheet. (0.6pt) AYUDA: pueden considerar que $V_D = V_f$. 
1. Elección de un valor de resistencia disponible en el anexo cercano al calculado, y en cuanto cambia $I_f$ con la nueva resistencia. Este será el valor que se utilizará en el prototipo. (0.3pt)
1. Cálculo de la potencia disipada en la resistencia $R_{22}$ cuando el LED está encendido. ¿Es menor que 1/4 W? (0.2pt)

## 2. Detector de envolvente

El prototipo de estetoscopio reproduce un sonido de corta duración cada vez que hay un pulso cardíaco. Así, de forma simplificada, para detectar un pulso se puede simplemente medir cuando el volumen supera un cierto umbral. Como el volumen es proporcional a la amplitud de la señal que alimenta el altavoz, se implementará un circuito que sigue la amplitud de dicho voltaje.

Para obtener la amplitud de una señal variable en el tiempo, se puede utilizar un circuito llamado detector de envolvente. La figura a continuación muestra la salida del detector de envolvente para la señal de entrada indicada:

![T2_envolvente](../img/T2_Envelope_follower.png)

Figura 3: Ejemplo de la envolvente de una señal

El circuito de detector de envolvente que se utilizará se muestra a continuación:

<img src="https://julianodb.github.io/electronic_circuits_diagrams/T5_active_envelope_detector.png" width="300">

Figura 4: Circuito detector de envolvente

?????


Cuando el voltaje $v_i$ es mayor que $v_o + V_f$, el diodo conduce. La corriente a través del diodo aumenta, lo que aumenta también la corriente en la resistencia $R_e$ y en el capacitor $C_e$. Eso hace con que $v_o$ aumente, hasta que llegue a $v_i - V_f$ y el circuito llegue a un punto de equilíbrio. Si $V_f$ del diodo es pequeño en comparación con $v_i$, podemos asumir que $v_o \approx v_i$.

Cuando el voltaje $v_i$ disminuye, por ejemplo en una señal cuadrada cuando el voltaje pasa de su valor máximo a su valor minimo, el diodo deja de conducir. En dicha situación, el capacitor empieza a descargarse a través de la resistencia $R_e$. Se puede mostrar que si el voltaje en el momento de corte es $V_{MAX}$, el valor de $v_o$ seguirá la siguiente ecuación- durante la descarga: 

$ v_o = V_{MAX} e^{-\frac{t}{R_e C_e}} $ (1)

La siguiente imagen muestra el resultado cuando $v_i$ es una señal cuadrada.

![envelope_waveform](../img/T2_envelope_waveform.png) 

Figura 4: Respuesta del detector de envolvente a una señal cuadrada

El diseño del detector de envolvente significa encontrar un equilíbrio entre el tiempo de respuesta y el tiempo de mantención del valor maximo:
- Si el producto $R_e C_e$ es muy pequeño, la salida no va a mantener el voltaje alto entre un período de la señal de entrada y el siguiente. En la figura 4 se muestra un ejemplo de éste problema. Idealmente, la descarga tiene que ser lenta lo suficiente para que la salida esté en un valor cercano al peak cuando empieza el siguiente ciclo de la señal de entrada, el cual la vuelve a cargar a $V_{MAX}$.
- Si el producto $R_e C_e$ es muy grande, el circuito se va a demorar mucho en descargar. Eso hace con que se mantenga la salida con un valor alto de voltaje incluso mucho tiempo después que la señal de entrada ya no está.

Para el EMG que se está diseñando, se identificaron los siguientes requerimientos:
1. Como la señal de EMG suele contener componentes de frecuencia entre 20 Hz y 500 Hz, el mayor período es de 50 ms. El detector de envolvente debe mantener al menos 50% del valor $V_{MAX}$ después de 50 ms de descarga.
2. Como no queremos que la indicación luminosa siga encendida después que se deja de activar los musculos, el tiempo que el detector de envolvente demora en descargar $v_o$ a $0.1 V_{MAX}$ debe ser menor o igual a 500 ms.

Determine el valor de $R_e$ y $C_e$ que cumplen con los requerimentos. El valor de la resistencia y del capacitor tienen que ser uno de los valores disponibles en el anexo.


## 3. Display


## Plazo de entrega: 23:59, XX de XXXX de 2025

## Anexo

I. Valores de Resistencias disponibles:

|   |  |        |       |  |
|------|------|-----------|------------|-------|
| 10Ω  | 220Ω | 1kΩ       | 6.8kΩ      | 100kΩ |
| 22Ω  | 270Ω | 2kΩ       | 10kΩ       | 220kΩ |
| 47Ω  | 330Ω | 2.2kΩ     | 20kΩ       | 300kΩ |
| 100Ω | 470Ω | 3.3kΩ     | 47kΩ       | 470kΩ |
| 150Ω | 510Ω | 4.7kΩ     | 51kΩ       | 680kΩ |
| 200Ω | 680Ω | 5.1kΩ     | 68kΩ       | 1MΩ   |

II. Valores de Capacitores Ceramicos disponibles:

|   |  |        |       |  |  |
| -------- | ------- | ------- | ----------- | --------- | --------- |
| 100 pF   | 1 nF    | 10 nF   | $0.1\ \mu F$ | $1\ \mu F$  | $10\ \mu F$ |
| 220 pF   | 2.2 nF  | 22 nF   | $0.22\ \mu F$ | -         | $22\ \mu F$ |
| 330 pF   | 3.3 nF  | 33 nF   | $0.33\ \mu F$ | -         | -         |
| 470 pF   | 4.7 nF  | 47 nF   | $0.47\ \mu F$ | $4.7\ \mu F$| -         |
| 680 pF   | 6.8 nF  | 68 nF   | $0.68\ \mu F$ | -         | -         |