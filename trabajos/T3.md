# <img src="https://julianodb.github.io/SISTEMAS_ELECTRONICOS_PARA_INGENIERIA_BIOMEDICA/img/logo_fing.png?raw=true" align="right" height="45"> Trabajo 3 de Sistemas Electrónicos

#### Primer Semestre de 2025

## Introducción

Este semestre, su grupo es responsable de diseñar y fabricar un prototipo de fotopletismógrafo para aplicar los conocimientos y tecnicas relacionados a la asignatura de Sistemas Electrónicos.

A grandes rasgos, el prototipo debe tener las siguientes funcionalidades:

1. medir la frecuencia cardíaca (Heart Rate - HR)
1. emitir una señal de luz infrarroja cuando hay un pulso cardíaco
1. detectar la señal infraroja emitida por otro prototipo
1. medir el tiempo entre la detección de la señal infrarroja y el siguiente pulso cardíaco (Pulse Transit Time - PTT)
1. Permitir la visualización de los valores de HR y PTT medidos

El sistema que deben diseñar puede ser dividido en los siguientes bloques:

![TX](../img/TX.png)

Figura 1: División del sistema del fotopletismógrafo en bloques

En tercer trabajo, los objetivos son los siguientes:

1. diseñar el gatillo del generador de pulso que generará un ancho de pulso más predecible para cada pulso cardíaco
1. finalizar el Latch SR haciendo sus entradas insensibles a la duración del pulso de entrada
1. proyectar un circuito detector de peaks para medir el PTT 

El trabajo será un ensayo que debe contener la siguiente información:

- Identificación del grupo (color)
- Identificación de los integrantes del grupo (nombres, apellidos y RUT)
- La información que se pide en cada una de las siguientes sesiones de este documento

## 1. Gatillo

Cuando la medición de temperatura se estabiliza, se generará un voltaje que cambia de 0 a 5 V, y se mantiene en 5 V mientras la temperatura está estable. Sin embargo, para gatillar el pulso de 1 segundo que encenderá el buzzer se requiere de un pulso de voltaje mucho más corto, de aproximadamente 50 ms. 

Para generar el pulso corto que gatilla el encendido del buzzer, se utilizará el siguiente circuito:

<img src="https://julianodb.github.io/electronic_circuits_diagrams/RC_highpass.png" width="200">

Figura 2: Filtro pasa-alta

4. Determinen la respuesta del circuito ($V_{out}$) para una entrada escalón de amplitud 5 V ($V_{in}$), en función a $R_{15}$ y $C_5$. (0.5pt)

5. Elijan un valor para $R_{15}$ de tal forma que la corriente que pasa por este está entre $5\ \mu A$ y $50\ \mu A$ cuando $V_{out}=1\ V$. El valor elegido debe ser uno de los valores disponibles en el anexo. (0.5pt)

6. Elijan un valor de $C_5$ de tal forma que la respuesta calculada en el ítem 4 se mantiene por sobre 2 V durante al menos 10 ms, y como máximo por 100 ms. (0.5pt)

Una vez que se tiene un voltaje $V_{out}$ que se mantiene por sobre 2 V durante algunos milisegundos, se puede utilizar dicho voltaje para encender un transistor en modo saturado durante dicho período de tiempo. El circuito a continuación implementa esta idea:


<img src="https://julianodb.github.io/electronic_circuits_diagrams/T3d.png" width="400">

Figura 3: Generador de pulso.

7. Elijan el valor de $R_{16}$ de tal forma que el transistor está saturado con un $\beta_{forzado} \approx 10$ cuando la corriente de base es igual a la corriente elegida en el ítem 5. Considere las siguientes características para el transistor $Q_6$: (0.5pt)

 | $V_{CE_{SAT}}$ | $V_{BE_{SAT}}$ | $\beta$ |
 | -- | -- | -- |
 | 100 mV | 800 mV | 100 |

Para finalizar el circuito, agregaremos la resistencia $R_{13} = R_{15}$  para descargar el capacitor $C_5$ cuando el voltaje de entrada es cero, y la resistencia $R_{16} = R_{15}$ para minimizar la corriente de fuga cuando el transistor está apagado.

<img src="https://julianodb.github.io/electronic_circuits_diagrams/T3e.png" width="400">

Figura 4: circuito completo


## 2. Latch SR (parte 2)

Al instalar en un paciente dos fotopletismografos con alguna distancia entre ellos, se observa que los pulsos cardiacos no se detectan exactamente al mismo tiempo. El atraso entre la detección de los pulsos se conoce como tiempo de tránsito del pulso (en inglés, Pulse transit time- PTT).

Para medir el PTT, primero es necesario generar una señal eléctrica que depende del PTT de alguna forma. La estrategia que adoptaremos es: cuando el primer dispositivo detecta un pulso cardiaco, la señal de PTT debe subir, y cuando el segundo dispositivo detecta el pulso, la señal debe bajar. de esta forma generamos pulsos de voltaje cuya duración es igual al PTT, conforme la imagen a continacion:

<!--img src="https://julianodb.github.io/electronic_circuits_diagrams/resistance_3_led.png" width="70"-->

Figura 6: Señal de pulsos con duración igual al PTT

Como se puede observar, en el dispositivo 1 la logica de la señal es que el voltaje suba cuando se detecta un pulso cardiaco, y que baje cuando recibe la señal infrarroja. Por otro lado, en el dispositivo 2, la logica es al revés: que el voltaje suba cuando recibe una señal infrarroja, y baje cuando detecte el pulso cardíaco. El prototipo contendrá un botón para seleccionar si debe actuar como dispositivo 1 o 2.

Tanto al tratarse del dispositivo 1 como 2, se necesita un circuito con dos posibles voltajes de salida (0V y 5V). Además, debe ser capaz de ajustar la salida a 5V cuando es gatillado por una señal, y mantenerla en 5V hasta que se gatille la otra señal. Un circuito que implementa dicha funcionalidad se conoce como Latch SR (SR son las iniciales de Set y Reset).

Para implementar el Latch SR, empezaremos con el siguiente circuito:

<img src="https://julianodb.github.io/electronic_circuits_diagrams/T2_npn_inverter.png" width="100">

Figura 7: Inversor

3. Elijan un valor disponible en el anexo para la resistencia $R_6$ de tal forma que $I_C \approx 1\ mA$ cuando $Q_3$ está saturado. (1pt)
4. Elijan un valor disponible en el anexo para la resistencia $R_9$ de tal forma que $\beta_{forzado} \approx 10$ cuando $V_i = 5\ V$. (1pt)

Al elegir los valores de $R_6$ y $R_9$ que cumplen con los criterios que se piden en los puntos 3 y 4, y considerando solamente dos posibles valores para la entrada $V_i$ (0 y 5 V), la idea es que el circuito también tenga solamente dos posibles valores de salida $V_C$: 0 y 5V. Cuando la entrada es 0 V, $Q_3$ está apagado y el voltaje $V_C$ es, por lo tanto 5V. Por otro lado, cuando la entrada es 5V, $Q_3$ está saturado y la salida $V_C$ es, por lo tanto aproximadamente 0 V. Es decir, el circuito de cierta forma "invierte" la entrada.

En el siguiente paso, conectamos una copia del circuito inversor a la salida del primero inversor ($R_7=R_6$, $R_8=R_9$):

<img src="https://julianodb.github.io/electronic_circuits_diagrams/T2_npn_double_inverter.png" width="200">

Figura 8: Doble inversor

El resultado es que la entrada se "invierte" dos veces, lo que significa que ahora el voltaje $V_o$ sigue la entrada: si $V_i = 5\ V$, $V_C \approx 0\ V$ y $V_o = 5\ V$; por otro lado, si $V_i = 0\ V$, $V_C = 5\ V$ y $V_o \approx 0 V$. Además, notese que ambos transistores siempre están en estados opuestos: si $Q_3$ está saturado, $Q_4$ está apagado, y si $Q_3$ está apagado, $Q_4$ está saturado.

En el siguiente paso, conectamos la salida del circuito a su entrada, de tal forma que ya no se necesita $V_i$ para mantener el circuito en uno de sus dos estados. El circuito resultante se va a mantener o encendido ($Q_3$ saturado, $Q_4$ apagado, $V_o=5\ V$) o apagado ($Q_3$ apagado, $Q_4$ saturado, $V_o\approx 0\ V$) de forma permanente.

<img src="https://julianodb.github.io/electronic_circuits_diagrams/T2_latch2.png" width="300">

Figura 9: Latch

Finalmente, introducimos dos transistores que permiten seleccionars en cual estado queremos mantener el circuito. Tanto $Q_5$ y $Q_6$ se mantendrán apagados la mayor parte del tiempo, y encenderemos apenas uno de ellos a la vez por un breve periodo de tiempo para configurar el circuito. Cuando activemos (saturemos) $Q_5$, la base de $Q_3$ se conecta a tierra, lo que lo apaga y, por lo tanto, satura $Q_4$. A partir de entonces, $Q_3$ se mantendrá apagado y $Q_4$ saturado incluso si apagamos $Q_5$. Por otro lado, cuando activamos $Q_6$, $Q_4$ se apaga, lo que satura $Q_3$. Luego, $Q_3$ se mantendrá saturado y $Q_4$ apagado incluso cuando apagamos $Q_6$. Así, se ha implementado un Latch SR.

<!--img src="https://julianodb.github.io/electronic_circuits_diagrams/resistance_3_led.png" width="70"-->

Figura 10: Latch SR

5. Elijan un valor para la resistencia $R_{45}$, que esté disponible en el anexo, de tal forma que $Q_5$ se satura con $\beta_{forzado} \approx 10$ cuando la señan de RESET es igual a 5V. Utilizaremos el mismo valor elegido para $R_{46}$. (1pt)

## Plazo de entrega: 23:59, 07 de Abril de 2025

## Anexo

I. Valores de Resistencias disponibles:

|   |  |        |       |  |
|------|------|-----------|------------|-------|
| 10Ω  | 220Ω | 1kΩ       | 6.8kΩ      | 100kΩ |
| 22Ω  | 270Ω | 2kΩ       | 10kΩ       | 220kΩ |
| 47Ω  | 330Ω | 2.2kΩ     | 20kΩ       | 300kΩ |
| 100Ω | 470Ω | 3.3kΩ     | 47kΩ       | 470kΩ |
| 150Ω | 510Ω | 4.7kΩ     | 51kΩ       | 680kΩ |
| 200Ω | 680Ω | 5.1kΩ     | 68kΩ       | 1M    |

II. Valores de Capacitores Ceramicos disponibles:

|   |  |        |       |  |
|------|------|-----------|------------|-------|
| 100 pF  | 220 pF | 330 pF | 470 pF | 680 pF |
| 1 nF  | 2.2 nF | 3.3 nF | 4.7 nF | 6.8 nF |
| 10 nF  | 22 nF | 33 nF | 47 nF | 68 nF |
| $0.1\ \mu F$  | $0.22\ \mu F$ | $0.33\ \mu F$| $0.47\ \mu F$ | $0.68\ \mu F$ |
| $1\ \mu F$  | - | - | $4.7\ \mu F$ | - |
| $10\ \mu F$  | $22\ \mu F$ | - | - | - |
