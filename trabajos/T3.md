# <img src="https://julianodb.github.io/SISTEMAS_ELECTRONICOS_PARA_INGENIERIA_BIOMEDICA/img/logo_fing.png?raw=true" align="right" height="45"> Trabajo 3 de Sistemas Electrónicos

#### Segundo Semestre de 2024

## Introducción

Este semestre, su grupo es responsable de diseñar y fabricar un prototipo de termometro médico electrónico para aplicar los conocimientos y tecnicas relacionados a la asignatura de Sistemas Electrónicos. 

A grandes rasgos, el prototipo debe tener las siguientes funcionalidades:

1. medir la temperatura en °C y mostrar su valor numérico con 1 casa decimal.
1. determinar cuando la medición de temperatura está estable e indicarlo con una señal sonora (bip).
1. encender una luz cuando la temperatura es muy alta o muy baja.
1. permitir el ajuste de los umbrales de temperatura alta y baja.
1. permitir el ajuste del criterio de estabilidad de la señal (más estricto o menos esctricto).
1. contener un sólo botón, que enciende el termometro cuando este está apagado, y lo apaga cuando este está encendido.
1. auto-apagado después de un tiempo ajustable de al menos aproximadamente 1 minuto.

Además, la fuente de energía debe ser una batería del tipo moneda/botón tamaño CR2032. Como esta fuente tiene pequeña capacidad energética, considerar bajo consumo de energía durante el desarrollo de todos los circuitos del termometro.

El sistema que deben diseñar puede ser dividido en los siguientes bloques:

![TX](../img/TX.png)

Figura 1: División del sistema del termometro electrónico en bloques

En el tercer trabajo, los objetivos son los siguientes:

1. estudiar el sensor de temperatura
1. diseñar el gatillo que indica cuando la temperatura está estable
1. diseñar la versión final del circuito que enciende o apaga el termometro cuando se apreta el botón

El trabajo será un ensayo que debe contener la siguiente información:

- Identificación del grupo (color)
- Identificación de los integrantes del grupo (nombres, apellidos y RUT)
- La información que se pide en cada una de las siguientes sesiones de este documento

## 1. Sensor de Temperatura

Finalmente ha llegado el momento de estudiar el sensor de temperatura que se utilizará en el prototipo de termometro. Cada grupo utilizará un sensor distinto, los que se indican a continuación:

- Grupo Blanco: MCP9700-E/TO
- Grupo Azul: MCP9701-E/TO
- Grupo Verde: LMT87LPGM
- Grupo Rojo: LMT86LPGM
- Grupo Amarillo: LMT85LPGM

Todos los sensores seleccionados funcionan en base a la influencia de la temperatura en la tensión en directa de un diodo. Si se considera la ecuación de Shockley:

$$I_D=I_S(e^{\frac{V_D}{n V_T}}-1)$$

Resolviendo para $V_D$:

$$V_D = n V_T \ln(\frac{I_D+I_S}{I_S})$$

Considerando que tipicamente $I_D >> I_S$ y reemplazando $V_T=\frac{kT}{q}$, donde T es la temperatura en Kelvin :

$$V_D = T\frac{ n k }{q} \ln(\frac{I_D}{I_S})$$

Nótese que si $I_D$ es constante, $V_D$ será simplemente una constante multiplicada por T. Este es el principio de funcionamiento de los sensores seleccionados. En la practica se requieren circuitos extras para producir la corriente constante, mejorar la precisión de la medición (tipicamente se mide la diferencia de voltaje entre dos diodos iguales por los cuales pasan dos corrientes distintas pero conocidas. Esto permite eliminar $I_S$ de la ecuación), y producir un voltaje en la salida que no consume corriente del diodo, lo que afectaria la medición. El resultado final es que los sensores se alimentan con un voltaje DC y producen un voltaje de salida que tiene una dependencia lineal con respecto a la temperatura del sensor.

La siguiente tabla muestra los rangos típicos de clasificación de temperatura corporal

![01_app](../img/temperature_range.png)

Basándose en esto, se requiere que el sensor tenga buena precisión especialmente en las mediciones entre 30°C y 45°C.

1. Busquen el datasheet del sensor que utilizará su grupo. Encuentren la aproximación lineal para la relación entre la temperatura en grados Celsius y el voltaje de salida del sensor. Es decir, encuentre el valor de los coeficientes a y b en la siguiente ecuación:

    $$V_{out}=aT_c + b$$

    Donde $T_c$ es la temperatura en grados celsius. Si necesario, linearicen la funcion de transferencia entre 30°C y 45°C . (1pt)

2. Para desplegar el valor de la temperatura en el display, se requiere de un voltaje que es 0 V cuando la temperatura es 0°C, y luego aumente 100 mV para cada °C. Es decir, se requiere un voltaje que implementa la siguiente relación:

    $$V_{temperatura} = 0.1 T_c$$

     Donde $T_c$ es la temperatura en grados celsius. Encuentren los valores de los coeficientes c y d en la siguiente ecuación, que permite transformar el $V_{out}$ del sensor de su grupo a $V_{temperatura}$: (0.5pt)

    $$V_{temperatura} = c V_{out} + d$$

    Obs: En el siguiente trabajo se implementará el circuito que convierte $V_{out}$ en $V_{temperatura}$.

3. Encuentren el consumo de corriente del sensor cuando está alimentado con 5V. (0.5pt)

## 2. Gatillo

Cuando el usuario presione el botón, se desconoce por cuanto tiempo lo mantendrá presionado, pero podemos suponer que es por un tiempo mayor a 100 ms. Para que el circuito de reset del peak generator no esté encendido por más tiempo del necesario, implementaremos un circuito que genera la señal de RESET de tal forma que se descarga a menos de 0 V entre 10 ms y 100 ms. Así, incluso si el usuario mantiene el botón presionado por más tiempo, la señal que enciende $Q_1$ sólo durará entre 10 ms y 100 ms

Para cumplir el objetivo, se utlizará un capacitor $C_3$ de la siguiente forma:

<img src="https://julianodb.github.io/electronic_circuits_diagrams/T3c.png" width="400">

Figura 3: Generador de pulso

5. Suponiendo que inicialmente el botón no está apretado (los voltajes en $C_3$, $D_4$, $R_5$ y la base de $Q_1$ son -5 V), y que en t=0 el usuario apreta y mantiene apretado el botón (el voltaje a la izquierda de $C_3$ sube a +5 V), determinen la ecuación de como evoluciona el voltaje RESET en el tiempo. Asuman que $D_4$ y la unión base-emisor de $Q_1$ están siempre polarizados en directa (es decir, conducen), que el $V_F$ de $D_4$ es 0.4 V, y el valor de $V_{BE}$ es el típico de la hoja de datos. (1pt)
6. Utilizando la ecuación encontrada en el punto 5, determinen los valores máximo y mínimo para el producto $R_5 C_3$ para que el voltaje RESET baje a 0 V entre 10 ms y 100 ms. (1pt)
7. Elijan una combinación de valores de resistencias y capacitores para $R_5$ y $C_3$, que estén disponibles en el anexo y que cumplan tanto con las restricciones del punto 6 cuanto las del punto 4. (0.5pt)

Para finalizar el circuito, agregaremos las resistencias $R_4$ y $R_6$ para descargar el capacitor $C_3$ cuando el usuario desaprete el botón, y la resistencia $R_7$ para minimizar la corriente de fuga cuando $Q_1$ está apagado.

<img src="https://julianodb.github.io/electronic_circuits_diagrams/T3b.png" width="400">

Figura 4: circuito completo

8. Suponiendo que el valor de $R_4$ y $R_6$ es igual al de $R_5$ elegido en el punto 7, calculen cuanto tiempo $C_3$ demora en descargar 95 % de su voltaje inicial cuando el botón no está apretado y $D_4$ está cortado. (0.5 pt)


## 3. Botón de encendido/apagado (parte 2)

<img src="https://julianodb.github.io/electronic_circuits_diagrams/T2_latch.png" width="400">


## Plazo de entrega: 23:59, 21 de Octubre de 2024

## Anexo

I. Valores de Resistencias disponibles:

|   |  |        |       |  |
|------|------|-----------|------------|-------|
| 10Ω  | 220Ω | 1kΩ       | 6.8kΩ      | 100kΩ |
| 22Ω  | 270Ω | 2kΩ       | 10kΩ       | 220kΩ |
| 47Ω  | 330Ω | 2.2kΩ     | 20kΩ       | 300kΩ |
| 100Ω | 470Ω | 3.3kΩ     | 47kΩ       | 470kΩ |
| 150Ω | 510Ω | 4.7kΩ     | 51kΩ       | 680kΩ |
| 200Ω | 680Ω | 5.1kΩ     | 68kΩ       | 1M    |

II. Valores de Capacitores Ceramicos disponibles:

|   |  |        |       |  |
|------|------|-----------|------------|-------|
| 100 pF  | 220 pF | 330 pF | 470 pF | 680 pF |
| 1 nF  | 2.2 nF | 3.3 nF | 4.7 nF | 6.8 nF |
| 10 nF  | 22 nF | 33 nF | 47 nF | 68 nF |
| $0.1\ \mu F$  | $0.22\ \mu F$ | $0.33\ \mu F$| $0.47\ \mu F$ | $0.68\ \mu F$ |
| $1\ \mu F$  | - | - | $4.7\ \mu F$ | - |
| $10\ \mu F$  | $22\ \mu F$ | - | - | - |