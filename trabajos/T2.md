# <img src="https://julianodb.github.io/SISTEMAS_ELECTRONICOS_PARA_INGENIERIA_BIOMEDICA/img/logo_fing.png?raw=true" align="right" height="45"> Trabajo 2 de Sistemas Electrónicos

#### Segundo Semestre de 2025

## Introducción

Este semestre, su grupo es responsable de diseñar y fabricar un prototipo de estetoscopio electrónico para aplicar los conocimientos y tecnicas relacionados a la asignatura de Sistemas Electrónicos.

El prototipo debe tener las siguientes funcionalidades:

1. Medir, amplificar, filtrar y reproducir los sonidos corporales
1. Permitir controlar el volúmen
1. Estimar y permitir la visualización de la frecuencia cardíaca (Heart Rate - HR)
1. Emitir una señal de luz cuando hay un pulso cardíaco

El sistema que deben diseñar puede ser dividido en los siguientes bloques:

![TX](../img/TX.png)

Figura 1: División del sistema del estetoscopio electrónico en bloques

En el segundo trabajo, los objetivos son los siguientes:

1. Diseñar el circuito de tierra virtual
1. Diseñar el circuito del micrófono y estudiar de qué manera afecta al amplificador 1
1. Preparar para fabricar la PLACA 1

El trabajo será un ensayo que debe contener la siguiente información:

- Identificación del grupo (color)
- Identificación de los integrantes del grupo (nombres, apellidos y RUT)
- La información que se pide en cada una de las siguientes sesiones de este documento

## 1. Tierra Virtual

Algunos de los circuitos que se utilizarán en el prototipo de estetoscópio producen voltajes negativos. Sin embargo, sólo está disponible una fuente de alimentación positiva de 5 V. Por lo tanto, en los circuitos que lo requieran, será necesario algún tipo de adaptación para que la fuente de alimentación incluya voltajes negativos.

Una forma simple de adaptar la fuente para que incluya voltajes menores que cero es producir un voltaje intermedio y utilizarlo como la tierra del circuito. Por ejemplo, si solo tenemos disponible una fuente de 5 V, podemos generar un voltaje de 2.5 V y utilizarlo como la nueva tierra del circuito, lo que se conoce como tierra virtual. De ésta forma, la salida positiva de la fuente de alimentación medida con respecto a la tierra virtual seria +2.5 V, mientras que la salida negativa seria -2.5 V.

Para generar el voltaje de 2.5 V que actuará como tierra virtual, se utilizará el siguiente circuito:

<img src="https://julianodb.github.io/electronic_circuits_diagrams/half_voltage_divider_b.png" width="170">

Figura 2: Divisor de voltaje

Donde $V_{bias\ weak}$ es el voltaje de la tierra virtual. 

1. Elijan los valores de $R_{9}$ y $R_{10}$, que estén disponible en el anexo, de tal forma que $V_{bias\ weak} = 2.5\ V$ y la corriente a través de las resistencias es menor a $100\ \mu A$. (0.3pt)

Es común agregar un capacitor conectado a tierra para atenuar cualquier ruido en voltajes que deben ser constantes. Por esta razón se incluye el capacitor $C_{7}$ para estabilizar $V_{bias\ weak}$.

2. Elijan el mayor valor de capacitancia disponible en el anexo para $C_{7}$ de tal forma que $R_{10} C_7  \leq 5$ segundos. (0.3pt)

3. Determinen la resistencia de salida del circuito de la figura 2. Pueden considerar solamente el análisis en DC para este ejercicio. Es decir, pueden ignorar $C_7$. (0.5pt)

Como la resistencia de salida del circuito es muy alta, no se pueden conectar circuitos que consumen mucha corriente a $V_{bias\ weak}$ , una vez que afectarían su voltaje. Una forma de entenderlo es considerar que al conectar una resistencia de carga $R_L$ entre $V_{bias\ weak}$ y tierra, ésta apareceria en paralelo a $R_{10}$, disminuyendo su valor efectivo y, por lo tanto disminuyendo el valor de $V_{bias\ weak}$ . Para mejorar la capacidad de la tierra virtual de entregar o consumir corrientes se utilizará un buffer, el que se muestra en la figura a continuación.

<img src="https://julianodb.github.io/electronic_circuits_diagrams/buffer_vbias.png" width="220">

Figura 3: Buffer

El buffer es un circuito que utiliza un amplificador operacional para producir un voltaje de salida idéntico al de entrada. La utilidad del buffer está en tener una resistencia de entrada muy alta y una resistencia de salida muy baja, lo que ayuda a desacoplar la señal de entrada y la de salida. Es decir, permite consumir muy poca corriente de la señal de entrada, al mismo tiempo en que se entrega mucho más corriente en en circuito de salida. $V_{bias}$ es la tierra virtual que efectivamente se conectará a los circuitos que la requieran.

4. Determinen la resistencia de entrada del buffer y calculen en cuanto cambia el valor de $V_{bias\ weak}$ en DC cuando se conecta al buffer. Consideren que el amplificador operacional utilizado es el LM324. (0.5pt)

5. Determinen la resistencia de salida del buffer. Consideren que el amplificador operacional utilizado es el LM324. (0.5pt)

   AYUDA: una forma de estimar la resistencia de salida del amplificador operacional es dividiendo el voltaje de alimentación por la corriente de corto circuito (maxima) de salida.

## 2. Micrófono

Un componente essencial en el estetoscopio electrónico es el micrófono, responsable por convertir la señal sonora en una señal eléctrica. En el prototipo en desarrollo, se utilizará el micrófono de electreto CZN-15E para cumplir esta función.

<img src="https://julianodb.github.io/electronic_circuits_diagrams/electret_mic.png" width="80">

Figura 4: Símbolo del micrófono de electreto.

Los micrófonos de electreto necesitan de alimentación y, mientras el voltaje entre sus terminales esté dentro del rango apropriado, funcionan como una fuente de corriente. La corriente producida por el micrófono de electreto tiene una componente constante independiente del ruido, más una componente variable que es proporcional al movimiento producido por las ondas sonoras. Por ejemplo, en la ausencia de ruido un micrófono podría producir una corriente de $i_s = 5 * 10^{-4}$ [A]. Luego al exponer el micrófono a una onda sonora con frecuencia $1\ kHz$, la corriente medida podría ser $i_s = 5 * 10^{-4} + 1 * 10^{-6} cos(\omega t)$ [A], con $\omega = 2 \pi 1000$ rad/s.

<img src="https://julianodb.github.io/electronic_circuits_diagrams/electret_mic_model.png" width="150">

Figura 5: Modelo del micrófono de electreto

En resúmen, $i_s = i_{s, constante} + i_{s, variable} $

Para el micrófono CZN-15E, la corriente de consumo maxima es de 0.5 mA ($i_{s, constante}$). Además, el micrófono necesita un voltaje mínimo de 1.5 V y máximo de 10 V para funcionar. Al medir el consumo real de una muestra de los micrófonos en el laboratorio se obtuvo un consumo entre 0.4 mA y 0.5 mA, cuando el voltaje era de aproximadamente 4 V. 

Típicamente se utiliza una resistencia conectada a la fuente de alimentación para proveer la corriente de consumo y voltaje de operación del micrófono, conforme se muestra en la figura a continuación:

<img src="https://julianodb.github.io/electronic_circuits_diagrams/electret_polarized.png" width="60">

Figura 6: Micrófono de electreto polarizado

6. Elijan un valor para $R_1$, que esté disponible en el anexo, y que produzca un voltaje en el micrófono entre 3 V y 4 V ($v_s-v_{EE} \in [3,4]\ V$) cuando su consumo de corriente es de 0.5 mA . Asuman que $V_{CC} = 2.5\ V$ y $V_{EE} = -2.5\ V$. (0.5pt)

La presencia de $R_1$ produce un voltaje $v_s$ que está relacionado a la corriente del microfono $i_s$ (y, por lo tanto, a la señal sonora):

$v_s = V_{CC} - R_1 i_s = V_{CC} - R_1 i_{s, constante} - R_1 i_{s, variable}$

Si definimos:

$v_{s,constante} =  V_{CC} - R_1 i_{s, constante} $

$v_{s,variable} =  - R_1 i_{s, variable} $

Se obtiene:

$v_s = v_{s,constante} + v_{s,variable}$

7. Suponiendo que $i_s = 4 * 10^{-4} + 1 * 10^{-6} cos(\omega t)$ [A], con $\omega = 2 \pi 1000$ rad/s, determinen el valor de $v_{s,constante}$ y la amplitud de $v_{s,variable}$, en voltios. (0.5pt)

La amplitud de $v_{s,variable}$ es muy pequeña para producir sonidos en el altavoz. Por lo tanto, utilizaremos los circuitos amplificadores diseñados en el Trabajo 1 para amplificar $v_s$.

8. Considerando que $v_s$ se conecta al Amplificador 1, conforme la figura a continuación, y que $i_s = 4 * 10^{-4} + 1 * 10^{-6} cos(\omega t)$ [A], con $\omega = 2 \pi 1000$ rad/s, determinen el valor del voltaje en la salida del Amplificador 1 ($v_{o1}$). (0.5pt)

   AYUDA: La salida de un amplificador operacional siempre produce un valor entre los dos voltajes de alimentación ($V_{CC}$ y $V_{EE}$)

<img src="https://julianodb.github.io/electronic_circuits_diagrams/T2_electret_amplify_first_try.png" width="300">

Figura 7: Primer intento de conexión del Micrófono al Amplificador 1

El circuito anterior tiene un problema: se amplifica $v_s$ completa. Es decir, se amplifica tanto $v_{s, constante}$ como $v_{s, variable}$. Sin embargo, la señal de interés es solamente $v_{s, variable}$, pues es la parte que se relaciona a $i_{s, variable}$, y, por lo tanto, a la señal sonora. Además, la magnitud de $v_{s, constante}$ es mucho mayor que $v_{s, variable}$, lo que hace con que al intentar amplificar $v_{s, variable}$ por un valor muy alto, el mismo $A_V$ se aplica a $v_{s, constante}$ y terminamos saturando el amplificador operacional. Para solucionar este problema, haremos una pequeña modificación al circuito para que se elimine $v_{s,constante}$ antes del amplificador:

<img src="https://julianodb.github.io/electronic_circuits_diagrams/T2_electret_amplify_second_try.png" width="350">

Figura 8: Segundo intento de conexión del Micrófono al Amplificador 1

Se puede mostrar que, si el amplificador operacional no se satura, el circuito resultante es lineal. Es decir, si la entrada es la suma de dos señales a y b, la salida del circuito se puede calcular primero para a, luego para b y finalmente sumarse. En otras palabras, "salida(a+b) = salida(a) + salida(b)". Por lo tanto, para entender la salida del circuito cuando $v_s = v_{s,constante} + v_{s,variable}$, podemos analisar primero cual es la salida para $v_{s,constante}$, luego cual es la salida para $v_{s,variable}$ y sumar los dos resultados.

### Analisis DC

Partiremos analisando el circuito cuando la entrada es solamente la componente constante de $v_s$. 

9. Determinen el voltaje en la salida del Amplificador 1 ($v_{o1}$) en la Figura 8 cuando $i_s = 4 * 10^{-4}$ [A]. Reemplacen $C_1$ por una resistencia con el valor de la impedancia de $C_1$ en corriente contínua ($\omega=0$) para realizar este analisis. (0.5pt)

### Analisis AC

10. Elijan un valor para el capacitor $C_1$, que esté disponible en el anexo, de tal forma que la magnitud de su impedancia a 20 Hz sea similar a la resistencia de entrada del Amplificador 1 (margen de 50%). Pueden elegir tanto un capacitor ceramico cuanto electrolitico. (0.3pt)

11. Una vez elegido $C_1$, determinen la amplitud del voltaje en la salida del Amplificador 1 ($v_{o1}$) en la Figura 8 cuando $i_s = 1 * 10^{-6} cos(\omega t)$ [A], con $\omega = 2 \pi 1000$ rad/s. Reemplacen $C_1$ por una resistencia con el valor de su impedancia en la frecuencia $\omega$ para realizar este analisis. Repitan el ejercicio cambiando la frecuencia de la señal $i_s$ a 20 Hz y a 20 kHz. (0.5pt)

## 3. Preparación para la fabricación

El circuito completo del estetoscopio electronico hasta el momento se muestra a continuación:

<img src="https://julianodb.github.io/electronic_circuits_diagrams/T2_stethoscope_so_far.png" width="800">

Figura 9: Circuito completo del estetoscopio electrónico hasta el Trabajo 2

12. Determinen el rango de la ganancia de voltaje $A_V$ del sistema completo, entre 20 Hz y 20 kHz. Consideren que la entrada $v_s$ es el voltaje entre el micórfono y $R_1$ y que la salida $v_o$ es el voltaje en el altavoz. (0.4pt)

En el Laboratorio Presencial 3 su grupo irá a fabricar el circuito de la figura 9. En preparación para esto, es útil producir un documento conocido como "lista de materiales" o "BOM" (del inglés, bill of materials), donde se listan los valores de cada componente. 

13. Completen la BOM a continuación con el valor de los componentes elegidos hasta el momento. (0.7pt)
   - Consulten la hoja de datos del LM386 para encontrar los valores de $R_8$, $C_5$ y $C_6$ (busquen el circuito de aplicación típica con ganancia = 20), y elijan los valores disponibles en anexo más cercanos. 
   - Para $C_4$, elijan un valor de **capacitor ceramico**, disponible en el anexo, tal que su impedancia a 20 Hz es menor que la resistencia de entrada del LM386.

| Componente | &nbsp;&nbsp; Valor &nbsp;&nbsp; | | Componente | &nbsp;&nbsp; Valor &nbsp;&nbsp; |
| -- | -- | -- | -- | -- |
| $R_1$ | | | $R_{10}$ | |
| $R_2$ | | | $R_{pot1}$ | |
| $R_3$ | | | $C_1$ | |
| $R_6$ | | | $C_4$ | |
| $R_7$ | | | $C_5$ | |
| $R_8$ | | | $C_6$ | |
| $R_9$ | | | $C_7$ | |

## Plazo de entrega: 23:59, 01 de Septiembre de 2025

## Anexos

I. Valores de Resistencias disponibles:

|   |  |        |       |  |
|------|------|-----------|------------|-------|
| 10Ω  | 220Ω | 1kΩ       | 6.8kΩ      | 100kΩ |
| 22Ω  | 270Ω | 2kΩ       | 10kΩ       | 220kΩ |
| 47Ω  | 330Ω | 2.2kΩ     | 20kΩ       | 300kΩ |
| 100Ω | 470Ω | 3.3kΩ     | 47kΩ       | 470kΩ |
| 150Ω | 510Ω | 4.7kΩ     | 51kΩ       | 680kΩ |
| 200Ω | 680Ω | 5.1kΩ     | 68kΩ       | 1MΩ   |


II. Valores de Capacitores Ceramicos disponibles:

|   |  |        |       |  |  |
| -------- | ------- | ------- | ----------- | --------- | --------- |
| 100 pF   | 1 nF    | 10 nF   | $0.1\ \mu F$ | $1\ \mu F$  | $10\ \mu F$ |
| 220 pF   | 2.2 nF  | 22 nF   | $0.22\ \mu F$ | -         | $22\ \mu F$ |
| 330 pF   | 3.3 nF  | 33 nF   | $0.33\ \mu F$ | -         | -         |
| 470 pF   | 4.7 nF  | 47 nF   | $0.47\ \mu F$ | $4.7\ \mu F$| -         |
| 680 pF   | 6.8 nF  | 68 nF   | $0.68\ \mu F$ | -         | -         |

III. Valores de Capacitores Electrolíticos disponibles:

|   |  |        |       |
|------|------|-----------|------------|
| $1\ \mu F$  | $10\ \mu F$ | $100\ \mu F$       | $1000\ \mu F$      |
| $2.2\ \mu F$  | $22\ \mu F$ | $220\ \mu F$       | -       |
| $3.3\ \mu F$  | $33\ \mu F$ | $330\ \mu F$     | -       |
| $4.7\ \mu F$ | $47\ \mu F$ | $470\ \mu F$     | -       |
